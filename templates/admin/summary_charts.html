{% extends "layout.html" %}
{% block content %}
<div class="dashboard-container">
    <div class="dashboard-header">
        <h1>System Summary</h1>
        <a href="{{ url_for('admin.admin_dashboard') }}" class="btn btn-outline">&laquo; Back to Dashboard</a>
    </div>
    <hr>

    <div class="summary-total">
        <h2>Total Revenue Generated</h2>
        <p>₹{{ "%.2f"|format(total_revenue) }}</p>
    </div>

    <div class="chart-card">
        <h3>Revenue by Parking Lot</h3>
        <canvas id="revenueByLotChart"></canvas>
    </div>

    <div class="charts-grid">
        <div class="chart-card">
            <h3>Overall Spot Status</h3>
            <canvas id="spotStatusChart"></canvas>
        </div>
        <div class="chart-card">
            <h3>Lot Capacity</h3>
            <canvas id="lotCapacityChart"></canvas>
        </div>
    </div>
</div>

<script>
document.addEventListener('DOMContentLoaded', function () {
    // --- Chart for Revenue by Lot ---
    const revenueCtx = document.getElementById('revenueByLotChart').getContext('2d');
    new Chart(revenueCtx, {
        type: 'bar',
        data: {
            labels: {{ lot_names|tojson }},
            datasets: [{
                label: 'Revenue (₹)',
                data: {{ revenue_per_lot|tojson }},
                backgroundColor: 'rgba(200, 35, 51, 0.6)', // Red
                borderColor: 'rgba(200, 35, 51, 1)',
                borderWidth: 1
            }]
        },
        options: { scales: { y: { beginAtZero: true } } }
    });

    // --- Pie Chart for Spot Status ---
    const spotCtx = document.getElementById('spotStatusChart').getContext('2d');
    new Chart(spotCtx, {
        type: 'pie',
        data: {
            labels: ['Available', 'Occupied', 'Reserved'],
            datasets: [{
                data: [{{ available_spots }}, {{ occupied_spots }}, {{ reserved_spots }}],
                backgroundColor: [
                    'rgba(40, 167, 69, 0.7)',  // Green
                    'rgba(220, 53, 69, 0.7)',  // Red
                    'rgba(255, 193, 7, 0.7)'   // Yellow
                ]
            }]
        }
    });

    // --- Bar Chart for Lot Capacity ---
    const lotCtx = document.getElementById('lotCapacityChart').getContext('2d');
    new Chart(lotCtx, {
        type: 'bar',
        data: {
            labels: {{ lot_names|tojson }},
            datasets: [{
                label: 'Total Capacity',
                data: {{ lot_capacities|tojson }},
                backgroundColor: 'rgba(0, 123, 255, 0.6)',
                borderColor: 'rgba(0, 123, 255, 1)',
                borderWidth: 1
            }]
        },
        options: { scales: { y: { beginAtZero: true } } }
    });
});
</script>

<style>
.charts-grid {
    display: grid;
    grid-template-columns: 1fr 1fr;
    gap: 2rem;
    margin-top: 2rem;
}
.chart-card {
    background-color: #fff;
    padding: 1.5rem;
    border-radius: 0.5rem;
    box-shadow: 0 2px 4px rgba(0,0,0,0.04);
    margin-top: 2rem;
}
.chart-card h3 {
    text-align: center;
    margin-top: 0;
    margin-bottom: 1.5rem;
}
.summary-total {
    background-color: #343a40;
    color: #fff;
    padding: 2rem;
    border-radius: 0.5rem;
    text-align: center;
    margin-bottom: 1.5rem;
}
.summary-total h2 {
    margin: 0;
    font-size: 1.25rem;
    font-weight: 400;
}
.summary-total p {
    margin: 0;
    font-size: 3rem;
    font-weight: 700;
}
</style>
{% endblock %}